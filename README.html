<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hello!</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><h1 id="guard-dog-v100">Guard Dog -v1.0.0</h1>

<p><img src="https://raw.githubusercontent.com/rajithadon/guarddog/master/guarddog-logo.jpg" alt="enter image description here" title=""> <br>
<strong>npm        install    guarddog</strong> <br>
<a href="https://www.npmjs.com/package/guarddog">https://www.npmjs.com/package/guarddog</a></p>

<p>A <strong>middleware</strong> mainly for <strong>expressjs</strong> to validate and filter out unwanted API requests and, to define an <strong>expected schema</strong> with data types for JSON objects.</p>

<h2 id="architecture">Architecture</h2>

<p>Node.JS APIs are mostly designed to receive http requests with JSON objects. Almost always there is an expected object schema for that particular API.    </p>

<blockquote>
  <p><strong>Note:</strong></p>
  
  <ul>
  <li>Even though the API is secured using a tokening mechanism , attacker can obtain a token , he can inject the server code with unnecessary API requests .</li>
  <li>Attacker can do minor changes to JSON payloads and attack directly in to your code and it may give valid results from the backend.</li>
  <li>Running unexpected objects all over the application can cause unhandled exceptions and in unexpected places </li>
  </ul>
</blockquote>

<h4 id="example"><i class="icon-file"></i> Example</h4>

<blockquote>
  <p><strong>Expected object :-</strong> <br>
   <strong>{</strong> credentials: <strong>{</strong> username: “John” , password :”1234”<strong>}}</strong></p>
  
  <p><strong>Actual Object</strong>  <br>
    <strong>{</strong> cred: <strong>{</strong> username: “John” , password :”1234”<strong>}}</strong></p>
  
  <p><strong>var username = object.credentials.username ;</strong> <br>
  This code will  return an error saying, <strong>cannot read property username of null</strong>.</p>
</blockquote>



<h4 id="solution"><i class="icon-file"></i> Solution</h4>



<div class="sequence-diagram"><svg height="294" version="1.1" width="427.9375" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.453125px;"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.2</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock55-obj608" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj611" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj614" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj617" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="10" y="20" width="81.03125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="19.984375" y="30" width="61.03125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="50.515625" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Front End</tspan></text><rect x="10" y="235" width="81.03125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="19.984375" y="245" width="61.03125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="50.515625" y="254.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Front End</tspan></text><path fill="none" stroke="#000000" d="M50.515625,59L50.515625,235" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="111.03125" y="20" width="95.75" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="121.40625" y="30" width="75.75" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="158.90625" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Body Parser</tspan></text><rect x="111.03125" y="235" width="95.75" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="121.40625" y="245" width="75.75" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="158.90625" y="254.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Body Parser</tspan></text><path fill="none" stroke="#000000" d="M158.90625,59L158.90625,235" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="226.78125" y="20" width="82.921875" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="236.984375" y="30" width="62.921875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="268.2421875" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Guarddog</tspan></text><rect x="226.78125" y="235" width="82.921875" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="236.984375" y="245" width="62.921875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="268.2421875" y="254.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Guarddog</tspan></text><path fill="none" stroke="#000000" d="M268.2421875,59L268.2421875,235" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="334.734375" y="20" width="63.203125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="345.125" y="30" width="43.203125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="366.3359375" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Router</tspan></text><rect x="334.734375" y="235" width="63.203125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="345.125" y="245" width="43.203125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="366.3359375" y="254.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Router</tspan></text><path fill="none" stroke="#000000" d="M366.3359375,59L366.3359375,235" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="66.03125" y="74.5" width="78.28125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="104.7109375" y="84" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">http request</tspan></text><path fill="none" stroke="#000000" d="M50.515625,98C50.515625,98,132.6246495852247,98,153.9136593775852,98" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj608)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="170.84375" y="113.5" width="86.359375" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="213.57421875" y="123" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">parsed object</tspan></text><path fill="none" stroke="#000000" d="M158.90625,137C158.90625,137,241.8243335536681,137,263.24213931533336,137" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj611)" stroke-dasharray="6,2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="278.203125" y="152.5" width="78.09375" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="317.2890625" y="162" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">valid output</tspan></text><path fill="none" stroke="#000000" d="M268.2421875,176C268.2421875,176,341.3469977378845,176,361.33659428730607,176" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj614)" stroke-dasharray="6,2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="179.828125" y="191.5" width="57.71875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="208.42578125" y="201" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">response</tspan></text><path fill="none" stroke="#000000" d="M366.3359375,215C366.3359375,215,95.79827591357753,215,55.508243304271446,215" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj617)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg></div>

<h2 id="how-to-use">How to use</h2>



<h4 id="1-install-the-npm-package-guarddog">1. Install the NPM package Guarddog</h4>

<p>You can install the npm using following command in your project,</p>

<p><a href="https://www.npmjs.com/package/guarddog">npm    install –save guarddog</a></p>

<blockquote>
  <p>As a prerequisite ,a body parser has to be used.  If you haven’t any, you can install by  <br>
  npm install  –save body-parser</p>
</blockquote>

<hr>



<h4 id="2-require-guarddog-in-your-project">2.  Require Guarddog in your project</h4>

<p>var bodyParser =  require(‘body-parser’); <br>
var <strong>guardDog</strong>=require(‘guarddog’);</p>

<hr>



<h4 id="3-define-a-strategy-for-guarddog">3.  Define a strategy for Guarddog</h4>

<blockquote>
  <p>guardDog.<strong>setStratergyJson</strong>(stratergyJson);</p>
</blockquote>

<p>stratergyJson should have 2 major properties. </p>

<ul>
<li><strong>apis</strong> : expected api schema</li>
<li><strong>onFail</strong>: fail event  ( this function will be called in case of a mismatch)</li>
</ul>

<p>Sample object :</p>

<p>var stratergyJson={</p>

<pre><code>onFail:function(msg){
    console.log("Failure : ",msg)
},
apis:{
    "/user/token":{
        POST:{
            body:[{
                    "credentials":{
                        "username":"string",
                        "password":"string"
                    }
                },
                {
                    "details":{
                        "age":"number",
                        "address":"string",
                        "code":"number",
                        "hobbies":"array"
                    }
                }

            ],


        }
    }
}
</code></pre>

<p>};</p>

<p>Here in this explanation , <strong>multiple body schemes</strong> are passed to body property of the “/user/token” api. Such scenarios you can use an object array to define multiple objects.</p>

<blockquote>
  <p><strong>Data types:</strong> Datatype should be given as values for the leaf nodes of json object. In above example, username is an string , age is a number and hobbies is an array. list of supporting data types are</p>
  
  <ul>
  <li>string</li>
  <li>number</li>
  <li>array </li>
  </ul>
  
  <p><strong>Method types:</strong> currently Guarddog  supports below methods only</p>
  
  <ul>
  <li>GET</li>
  <li>POST</li>
  <li>PUT </li>
  <li>DELETE</li>
  <li>PATCH</li>
  </ul>
</blockquote>

<hr>



<h4 id="3-put-the-guarddog-to-guard">3.  Put the guarddog to guard</h4>

<p>Here as a prerequisite ,<strong>stratergy should be set and the request should be parsed by a body parser as a must before it reaches the guarddog middleware</strong> . (since guarddog expects a body property in the request)</p>

<blockquote>
  <p>guardDog.setStratergyJson(stratergyJson);</p>
  
  <p>app.use(bodyParser.json()); <br>
  app.user(guardDog.guard)</p>
</blockquote>

<p>Please feel free to point out issues in  <a href="https://github.com/rajithadon/guarddog/issues">github issues of guarddog</a> .  <br>
Gurddog 2.0.0 is under development and will be released soon.</p>

<h2 id="author">Author</h2>

<p>Don Rajitha Dissanayake <br>
rajithadon@gmail.com</p></div></body>
</html>